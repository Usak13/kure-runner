<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Skákací kuře animace + efekty</title>
  <style>
    body {
      margin: 0;
      background: #87ceeb;
      font-family: Arial, sans-serif;
      text-align: center;
      user-select: none;
      overflow: hidden;
    }
    #gameCanvas {
      display: block;
      margin: 20px auto;
      background: #3a6;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    #score {
      font-size: 24px;
      color: #222;
      margin-top: 10px;
      font-weight: bold;
      text-shadow: 1px 1px 2px white;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="300"></canvas>
  <div id="score">Skóre: 0</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // --- POZADÍ (parallax) ---
  const backgroundLayers = [
    { img: new Image(), x: 0, speed: 0.2 }, // mraky
    { img: new Image(), x: 0, speed: 0.5 }, // hory
    { img: new Image(), x: 0, speed: 1 },   // tráva/podlaha
  ];
  backgroundLayers[0].img.src = 'https://i.imgur.com/2dzXhKw.png'; // mraky
  backgroundLayers[1].img.src = 'https://i.imgur.com/R3FDe9F.png'; // hory
  backgroundLayers[2].img.src = 'https://i.imgur.com/HLz0vpp.png'; // tráva

  // --- KUŘE (sprite sheet 4 snímky, 64x64) ---
  const chickenSprite = new Image();
  chickenSprite.src = 'https://i.imgur.com/CSvEFAz.png'; // Kuře 4 snímky chůze

  // --- ZVUKY ---
  const jumpSound = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
  const landSound = new Audio('https://actions.google.com/sounds/v1/impacts/wood_thud.ogg');
  const scoreSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');

  // --- HRÁČ ---
  const player = {
    x: 50,
    y: 220,
    width: 64,
    height: 64,
    vy: 0,
    gravity: 0.8,
    jumpForce: -15,
    grounded: false,
    frame: 0,
    frameCount: 4,
    frameTimer: 0,
    frameInterval: 10
  };

  // --- PŘEKÁŽKY ---
  const obstacleTypes = ['lava', 'voda', 'kamen'];
  const obstacles = [];
  const obstacleWidth = 30;
  let gameSpeed = 5;
  let frameCounter = 0;
  let score = 0;
  let gameOver = false;

  // --- ČÁSTICE PRAHU ---
  class Particle {
    constructor(x, y, color) {
      this.x = x;
      this.y = y;
      this.radius = Math.random() * 3 + 2;
      this.color = color;
      this.vx = (Math.random() - 0.5) * 3;
      this.vy = Math.random() * -3 - 1;
      this.alpha = 1;
      this.decay = 0.02;
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      this.alpha -= this.decay;
      this.vy += 0.1;
    }
    draw(ctx) {
      ctx.save();
      ctx.globalAlpha = this.alpha;
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }
  }
  const particles = [];

  // --- OVLÁDÁNÍ ---
  document.addEventListener('keydown', e => {
    if ((e.code === 'Space' || e.code === 'ArrowUp') && !gameOver) jump();
  });
  document.addEventListener('click', () => { if (!gameOver) jump(); });

  function jump() {
    if (player.grounded) {
      player.vy = player.jumpForce;
      player.grounded = false;
      jumpSound.play();
      spawnParticles(player.x + player.width / 2, player.y + player.height, '#fff8dc');
    }
  }

  function spawnParticles(x, y, color) {
    for(let i=0; i<10; i++) {
      particles.push(new Particle(x, y, color));
    }
  }

  // --- VYTVOŘENÍ PŘEKÁŽKY ---
  function createObstacle() {
    const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
    const y = 220;
    obstacles.push({ x: canvas.width, y, width: obstacleWidth, height: 50, type, frame: 0 });
  }

  // --- UPDATE ---
  function update() {
    if (gameOver) return;

    frameCounter++;
    if (frameCounter % 90 === 0) {
      createObstacle();
      if (gameSpeed < 12) gameSpeed += 0.2;
    }

    // Pohyb a animace překážek
    obstacles.forEach(obs => {
      obs.x -= gameSpeed;

      if(obs.type === 'lava') {
        obs.frame += 0.2;
        if(obs.frame > 3) obs.frame = 0;
      }
      if(obs.type === 'voda') {
        obs.y = 220 + Math.sin(frameCounter * 0.1 + obs.x * 0.05) * 5;
      }
    });

    // Odstranění překážek a skóre
    while (obstacles.length && obstacles[0].x + obstacleWidth < 0) {
      obstacles.shift();
      score++;
      scoreSound.play();
      document.getElementById('score').textContent = 'Skóre: ' + score;
    }

    // Gravitační pohyb hráče
    player.vy += player.gravity;
    player.y += player.vy;

    // Podlaha a přistání
    if (player.y > 220) {
      if (!player.grounded) {
        landSound.play();
        spawnParticles(player.x + player.width / 2, player.y + player.height, '#deb887');
      }
      player.y = 220;
      player.vy = 0;
      player.grounded = true;
    }

    // Kolize
    obstacles.forEach(obs => {
      if (
        player.x < obs.x + obs.width &&
        player.x + player.width > obs.x &&
        player.y < obs.y + obs.height &&
        player.y + player.height > obs.y
      ) {
        gameOver = true;
        alert('Konec hry! Skóre: ' + score);
        location.reload();
      }
    });

    // Animace kuřete (chodící frames)
    player.frameTimer++;
    if (player.frameTimer >= player.frameInterval) {
      player.frame = (player.frame + 1) % player.frameCount;
      player.frameTimer = 0;
    }

    // Update částic
    for(let i = particles.length -1; i >=0; i--) {
      particles[i].update();
      if(particles[i].alpha <= 0) particles.splice(i,1);
    }
  }

  // --- VYKRESLOVÁNÍ ---
  function drawBackground() {
    backgroundLayers.forEach(layer => {
      layer.x -= layer.speed * gameSpeed;
      if (layer.x <= -canvas.width) layer.x = 0;

      ctx.drawImage(layer.img, layer.x, 0, canvas.width, canvas.height);
      ctx.drawImage(layer.img, layer.x + canvas.width, 0, canvas.width, canvas.height);
    });
  }

  function drawObstacles() {
    obstacles.forEach(obs => {
      if(obs.type === 'lava') {
        const flicker = Math.floor(obs.frame) % 4;
        const colors = ['#d44', '#ff4500', '#b22222', '#ff6347'];
        ctx.fillStyle = colors[flicker];
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
        ctx.fillStyle = '#ffa500';
        for(let i=0; i<5; i++) {
          let bx = obs.x + Math.random()*obs.width;
          let by = obs.y + Math.random()*obs.height;
          ctx.fillRect(bx, by, 2, 2);
        }
      } else if(obs.type === 'voda') {
        ctx.fillStyle = '#3399ff';
        ctx.beginPath();
        ctx.ellipse(obs.x + obs.width/2, obs.y + obs.height/2, obs.width/2, obs.height/2 + 5 * Math.sin(frameCounter * 0.1), 0, 0, Math.PI*2);
        ctx.fill();
      } else {
        ctx.fillStyle = '#777';
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      }
    });
  }

  function drawParticles() {
    particles.forEach(p => p.draw(ctx));
  }

  function drawPlayer() {
    // Animovaný sprite - 4 snímky vedle sebe, každý 64x64 px
    ctx.drawImage(
      chickenSprite,
      player.frame * player.width, 0, player.width, player.height,
      player.x, player.y, player.width, player.height
    );
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    drawObstacles();
    drawParticles();
    drawPlayer();
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  // Po načtení obrázků začneme hru
  let loadedImages = 0;
  const totalImages = backgroundLayers.length + 1; // pozadí + kuře
  backgroundLayers.forEach(layer => layer.img.onload = () => {
    loadedImages++;
    if (loadedImages === totalImages) gameLoop();
  });
  chickenSprite.onload = () => {
    loadedImages++;
    if (loadedImages === totalImages) gameLoop();
  };
</script>
</body>
</html>
